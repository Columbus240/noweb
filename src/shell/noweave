#!/bin/sh
#
# Copyright 1991 by Norman Ramsey.  All rights reserved.
# See file COPYRIGHT for more information.
# options: -l == use LaTeX

MACROS=nwmac
latex=0
tex=1

if [ "X$1" = X-l ]; then
  latex=1
  tex=0
  shift
elif [ "X$1" = X-n ]; then
  latex=0
  tex=0
  shift

fi

LIB=|LIBDIR|
if [ $tex -eq 1 ]; then echo -n \\ ; echo input nwmac; fi
if [ $latex -eq 1 ]; then
    echo -n \\; echo 'documentstyle[noweb]{article}'; 
    echo -n \\ ; echo 'begin{document}'
fi
$LIB/markup $* | sed '
/^@begin code/,/^@end code/s/\\/\\\\/g
/^@begin code/,/^@end code/s/{/\\{/g
/^@begin code/,/^@end code/s/}/\\}/g
/^@quote$/,/^@endquote$/s/\\/\\\\/g
/^@quote$/,/^@endquote$/s/{/\\{/g
/^@quote$/,/^@endquote$/s/}/\\}/g
/^@defn /s/\[\[/\\code{}/g
/^@defn /s/\]\]/\\edoc{}/g
/^@use /s/\[\[/\\code{}/g
/^@use /s/\]\]/\\edoc{}/g
s/^@file \(.*\)$/\\filename{\1}/
s/^@quote$/@text \\code{}/
s/^@endquote$/@text \\edoc{}/
s/^@begin docs \([0-9]*\)$/\\begindocs{\1}/
s/^@begin docs \([0-9]*\)[^0-9].*$/\\begindocs{\1}/
s/^@end docs .*$/\\enddocs/
s/^@begin code \([0-9]*\)$/\\begincode{\1}/
s/^@begin code \([0-9]*\)[^0-9].*$/\\begincode{\1}/
s/^@end code .*$/\\endcode/
s/^@defn \(.*\)$/@text \\moddef{\1}\\endmoddef/
/^@attribute .*$/d
s/^@use \(.*\)$/@text \\LA{}\1\\RA{}/' | 
awk '
/^@nl$/ { print ""; next }
/^@text / { printf "%s", substr($0,7) ; next }
{ print }'
if [ $tex -eq 1 ]; then echo -n \\ ; echo bye; fi
if [ $latex -eq 1 ]; then echo -n \\; echo 'end{document}' ; fi
